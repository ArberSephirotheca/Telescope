{{! Everything is sourced from the API response data currently }}
{{#with data}}
    <div class="row justify-content-between">
        <h1 class="col-12 col-md-auto">{{target.first_name}} {{target.last_name}}</h1>

        {{! Edit profile link }}
        {{#if (and viewer.[0].username (eq target.username viewer.[0].username))}}
            <div class="col-12 col-md-3 d-flex align-items-center">
                <a class="btn btn-primary w-100 my-1" href="/edit_profile">
                    Edit Profile
                </a>
            </div>
        {{/if}}
    </div>

    {{! User Role }}
    <span class="badge badge-info">{{format_user_role target.role}}</span>

    {{! Cohort info }}
    {{#if target.cohort}}
        <span class="badge" style="background: var(--rpi-red);">
            RPI freshman class of {{target.cohort}}
        </span>
    {{/if}}

    {{! Created at }}
    <br>
    <span class="text-muted">
        Account created {{format_date target.created_at}} {{format_time target.created_at}}
    </span>

    {{! Account info -- RPI email, etc (Only visible to authenticated users)}}
    {{#if viewer.[0].username}}
        <h3 class="mt-2">User Info</h3>

        <div class="row row-cols-1 row-cols-md-2 row-cols-xl-4 mt-2">

            {{! RPI CAS }}
            <div class="col">
                <div class="card text-dark text-center">
                    <h5 class="card-header">RPI E-Mail</h5>
                    <div class="card-body p-1">
                        {{! If the user has linked RPI CAS }}
                        {{#if target.rcs_id.[0]}}
                            {{! Show the email }}
                            {{#with target.rcs_id.[0]}}
                                <a href="mailto:{{account_id}}@rpi.edu">
                                    {{account_id}}@rpi.edu
                                </a>
                            {{/with}}

                            {{! If the target is the viewer link to the unlink handler }}
                            {{#if (eq viewer.[0].username target.username)}}
                                <a href="/unlink/rpi_cas" class="btn btn-danger w-100 mt-1">
                                    Unlink this RPI CAS
                                </a>
                            {{/if}}
                        {{else}}
                            {{! Show a message indicating not linked and let the user link if it's their account. }}
                            RPI e-mail not linked.
                            {{#if (eq viewer.[0].username target.username)}}
                                <a href="/link/rpi_cas" class="btn btn-primary w-100">
                                    Link with RPI CAS.
                                </a>
                            {{/if}}
                        {{/if}}
                    </div>
                </div>
            </div>

            {{! Discord }}
            <div class="col">
                <div class="card text-dark text-center">
                    <h5 class="card-header">
                        Discord
                    </h5>

                    <div class="card-body p-1">
                        {{#if ../discord.target}}
                            {{! Discord is linked -- check if the discord info was successfully retieved. }}
                            {{#if ../discord.target.errored}}
                                Could not get discord info. Refresh the page perhaps?
                            {{else}}
                                {{! Display info about target user's Discord }}
                                {{! TODO }}
                            {{/if}}

                            {{! Check if user owns this account }}
                            {{#if (eq viewer.[0].username target.username)}}
                                {{! Allow owner to unlink dead Discord }}
                                <a href="/unlink/discord" class="btn btn-danger w-100">
                                    Unlink Discord

                                    {{! There is no feather icon for discord currently but I want a discord icon
                                    here so we do it manually. }}
                                    <svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 245 240" fill="currentColor">
                                        <path class="st0" d="M104.4 103.9c-5.7 0-10.2 5-10.2 11.1s4.6 11.1 10.2 11.1c5.7 0 10.2-5 10.2-11.1.1-6.1-4.5-11.1-10.2-11.1zM140.9 103.9c-5.7 0-10.2 5-10.2 11.1s4.6 11.1 10.2 11.1c5.7 0 10.2-5 10.2-11.1s-4.5-11.1-10.2-11.1z"/>
                                        <path class="st0" d="M189.5 20h-134C44.2 20 35 29.2 35 40.6v135.2c0 11.4 9.2 20.6 20.5 20.6h113.4l-5.3-18.5 12.8 11.9 12.1 11.2 21.5 19V40.6c0-11.4-9.2-20.6-20.5-20.6zm-38.6 130.6s-3.6-4.3-6.6-8.1c13.1-3.7 18.1-11.9 18.1-11.9-4.1 2.7-8 4.6-11.5 5.9-5 2.1-9.8 3.5-14.5 4.3-9.6 1.8-18.4 1.3-25.9-.1-5.7-1.1-10.6-2.7-14.7-4.3-2.3-.9-4.8-2-7.3-3.4-.3-.2-.6-.3-.9-.5-.2-.1-.3-.2-.4-.3-1.8-1-2.8-1.7-2.8-1.7s4.8 8 17.5 11.8c-3 3.8-6.7 8.3-6.7 8.3-22.1-.7-30.5-15.2-30.5-15.2 0-32.2 14.4-58.3 14.4-58.3 14.4-10.8 28.1-10.5 28.1-10.5l1 1.2c-18 5.2-26.3 13.1-26.3 13.1s2.2-1.2 5.9-2.9c10.7-4.7 19.2-6 22.7-6.3.6-.1 1.1-.2 1.7-.2 6.1-.8 13-1 20.2-.2 9.5 1.1 19.7 3.9 30.1 9.6 0 0-7.9-7.5-24.9-12.7l1.4-1.6s13.7-.3 28.1 10.5c0 0 14.4 26.1 14.4 58.3 0 0-8.5 14.5-30.6 15.2z"/>
                                    </svg>
                                </a>
                            {{/if}}
                        {{else}}
                            {{! Show message indicating not linked }}
                            No Discord account linked.

                            {{! Allow viewer to link their own discord if it's their account }}
                            {{#if (eq viewer.[0].username target.username)}}
                                <a href="/link/discord" class="btn btn-discord w-100">
                                    Link Discord

                                    {{! There is no feather icon for discord currently but I want a discord icon
                                    here so we do it manually. }}
                                    <svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 245 240" fill="currentColor">
                                        <path class="st0" d="M104.4 103.9c-5.7 0-10.2 5-10.2 11.1s4.6 11.1 10.2 11.1c5.7 0 10.2-5 10.2-11.1.1-6.1-4.5-11.1-10.2-11.1zM140.9 103.9c-5.7 0-10.2 5-10.2 11.1s4.6 11.1 10.2 11.1c5.7 0 10.2-5 10.2-11.1s-4.5-11.1-10.2-11.1z"/>
                                        <path class="st0" d="M189.5 20h-134C44.2 20 35 29.2 35 40.6v135.2c0 11.4 9.2 20.6 20.5 20.6h113.4l-5.3-18.5 12.8 11.9 12.1 11.2 21.5 19V40.6c0-11.4-9.2-20.6-20.5-20.6zm-38.6 130.6s-3.6-4.3-6.6-8.1c13.1-3.7 18.1-11.9 18.1-11.9-4.1 2.7-8 4.6-11.5 5.9-5 2.1-9.8 3.5-14.5 4.3-9.6 1.8-18.4 1.3-25.9-.1-5.7-1.1-10.6-2.7-14.7-4.3-2.3-.9-4.8-2-7.3-3.4-.3-.2-.6-.3-.9-.5-.2-.1-.3-.2-.4-.3-1.8-1-2.8-1.7-2.8-1.7s4.8 8 17.5 11.8c-3 3.8-6.7 8.3-6.7 8.3-22.1-.7-30.5-15.2-30.5-15.2 0-32.2 14.4-58.3 14.4-58.3 14.4-10.8 28.1-10.5 28.1-10.5l1 1.2c-18 5.2-26.3 13.1-26.3 13.1s2.2-1.2 5.9-2.9c10.7-4.7 19.2-6 22.7-6.3.6-.1 1.1-.2 1.7-.2 6.1-.8 13-1 20.2-.2 9.5 1.1 19.7 3.9 30.1 9.6 0 0-7.9-7.5-24.9-12.7l1.4-1.6s13.7-.3 28.1 10.5c0 0 14.4 26.1 14.4 58.3 0 0-8.5 14.5-30.6 15.2z"/>
                                    </svg>
                                </a>
                            {{/if}}
                        {{/if}}
                    </div>
                </div>
            </div>
        </div>
    {{/if}}

    {{! Enrollments }}
    <h3 class="mt-2">
        Enrollments
    </h3>
    {{#each target.enrollments}}
        <div class="card mt-1 text-dark">
            <div class="card-header">
                <h4 class="card-title">{{semester.title}}</h4>
            </div>
            <div class="card-body">
                {{! Badges }}
                {{! Coordinating }}
                {{#if is_coordinator}}
                    <span class="badge badge-primary">Coordinator</span>
                {{/if}}

                {{! Mentoring }}
                {{#each semester.small_groups}}
                    <span class="badge badge-info">{{title}} mentor</span>
                {{else}}
                    {{! No render }}
                {{/each}}

                <br>
                {{! Project info }}
                {{#if project.title}}
                    {{project.title}}
                    {{#if is_project_lead}}
                        Â· <span class="badge badge-success">Project Lead</span>
                    {{/if}}
                {{/if}}
            </div>
        </div>
    {{else}}
        No enrollment history.
    {{/each}}

    {{! Meetings the user has hosted }}
    {{! Include drafts if the viewer can see them }}
    {{#if (or
              (eq viewer.[0].username target.username)
              (or viewer.[0].is_current_coordinator.[0].is_coordinator
                  (or
                      (eq viewer.[0].role "sysadmin")
                      (eq viewer.[0].role "faculty_advisor"))))}}

        {{! Include drafts }}
        {{#if target.hosting}}
            <h3 class="mt-3">Meetings Hosted</h3>
            {{#each target.hosting}}
                {{> meetings/card this}}
            {{/each}}
        {{/if}}

    {{else}}
        {{! Do not include drafts }}
        {{#if (gt target.public_meetings_hosted.aggregate.count 0)}}
            <h3 class="mt-3">Meetings Hosted</h3>
            {{#each target.hosting}}
                {{> meetings/card this}}
            {{/each}}
        {{/if}}
    {{/if}}
{{/with}}
